{% extends "base.html" %}
{% block content %}
    <h1>Question Details</h1>

    <!-- Dropdown to select department -->
    <div class="form-group">
        <label for="department">Select Department</label>
        <form method="GET" action="{{ url_for('view_questions_by_department') }}">
            <select class="form-control" id="department" name="department_id" onchange="this.form.submit()">
                <option value="all" {% if selected_department_id == "all" %}selected{% endif %}>All Departments</option>
                {% for department in departments %}
                    <option value="{{ department.id }}" {% if selected_department_id == department.id %}selected{% endif %}>{{ department.name }}</option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- Display filtered questions -->
    <h2>Questions</h2>
    <ul class="list-group mb-4">
        {% if questions %}
            {% for question in questions %}
                <li class="list-group-item">
                    <h4>{{ question.question }}</h4>
                    <p><strong>Department:</strong> {{ question.department.name }}</p>
                    {% if question.file %}
                        <p><strong>Attached File:</strong> <a href="{{ url_for('static', filename='uploads/' + question.file) }}" target="_blank">{{ question.file }}</a></p>
                    {% endif %}

                    <!-- Display replies for this question -->
                    <h5>Replies:</h5>
                    <ul class="list-group mb-4">
                        {% if question.replies %}
                            {% for reply in question.replies %}
                                <li class="list-group-item">
                                    <p><strong>User {{ reply.user_id }} replied:</strong></p>
                                    <p>{{ reply.reply }}</p>
                                    {% if reply.file %}
                                        <p><strong>Attached File:</strong> <a href="{{ url_for('static', filename='uploads/' + reply.file) }}" target="_blank">{{ reply.file }}</a></p>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        {% else %}
                            <li class="list-group-item">No replies yet.</li>
                        {% endif %}
                    </ul>
                </li>
            {% endfor %}
        {% else %}
            <li class="list-group-item">No questions available for the selected department.</li>
        {% endif %}
    </ul>

{% endblock %}
